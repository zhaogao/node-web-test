<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>upload</title>
	<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<style type="text/css">
		.page{
			width:560px;
			margin:10% auto 0 auto;
		}
		.prev-head{
			display: inline-block;
			width:100px;
			height: 100px;
			background-color: #eee;
			vertical-align: top;
			margin-right: 10px;
		}
	</style>
</head>
<script src="https://cdn.bootcss.com/jquery/2.2.1/jquery.min.js"></script>
<script type="text/javascript">
	$(function(){
		$('#uploadbtn').on('change',function(){
			console.log(this.files[0])

			var file = this.files[0];

			var reader = new FileReader();

			reader.onload = function(e){
				var data = e.target.result;
				var img = new Image();
				img.onload = function(){
					console.log(this.width,this.height);
					// $('#prew-img').attr('src',data);
					//上传服务器
					var formData = new FormData();
					formData.append('head', $('#uploadbtn')[0].files[0]);
					$.ajax({
					    url: '/file_upload',
					    type: 'POST',
					    cache: false,
					    data: formData,
					    processData: false,
					    contentType: false
					}).done(function(res) {
						console.log('服务器路径',res)
						$('#prew-img').attr('src',res.headsrc);
					}).fail(function(res) {});
				}
				img.src=data;
			}

			reader.readAsDataURL(file);

		});

		$('#submit').on('click',function(ev){
			ev.preventDefault();
			// console.log($('#uploadbtn').files[0])
		});

	});
</script>
<body>
	<div class="page">
		
	<form class="form-horizontal" role="form" action="/file_upload" method="post" enctype="multipart/form-data">
		<div class="form-group">
			<label class="col-sm-2 control-label">用户名</label>
			<div class="col-sm-10">
			    <input type="email" name="name" class="form-control"  placeholder="用户名">
			 </div>
		</div>
		<div class="form-group">
			<label class="col-sm-2 control-label">年龄</label>
			<div class="col-sm-10">
			    <input type="email" name="age" class="form-control"  placeholder="年龄">
			 </div>
		</div>
		<div class="form-group">
			<label for="inputEmail3" class="col-sm-2 control-label">头像</label>
			<div class="col-sm-10">
				<img src="" alt="" id="prew-img" class="prev-head img-rounded">
				<label for="uploadbtn" class=" btn btn-default">上传头像</label>
			    <input type="file" class="hidden" id="uploadbtn" name="image" size="50" />
			 </div>
		</div>
		
		<div class="form-group">
			<div class="col-sm-offset-2 col-sm-10">
				<input type="submit" id="submit"   class="btn btn-primary" value="上传文件" />
			</div>
		
		</div>
	</form>
	</div>

</body>
</html>